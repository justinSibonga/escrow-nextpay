<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Escrow API Documentation | NextPay Integration</title>
    <meta name="description" content="Complete API documentation for building an Upwork-like freelance marketplace with secure escrow payments using NextPay Partners API." />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap"
      rel="stylesheet"
    />

    <link rel="stylesheet" href="style.css" />
  </head>
  <body>
    <div class="layout">
      <!-- Sidebar Navigation -->
      <aside class="sidebar" id="sidebar">
        <div class="sidebar-header">
          <span class="sidebar-badge">NextPay v1</span>
          <div class="search-container">
            <input 
              type="text" 
              class="search-input" 
              id="searchInput" 
              placeholder="Search documentation..."
              autocomplete="off"
            />
            <div class="search-results" id="searchResults"></div>
          </div>
        </div>

        <nav class="nav-section">
          <div class="nav-section-title">Getting Started</div>
          <a href="#overview" class="nav-link active">Platform Overview</a>
          <a href="#entities" class="nav-link">Core Entities</a>
          <a href="#authentication" class="nav-link">Authentication</a>
        </nav>

        <nav class="nav-section">
          <div class="nav-section-title">Setup</div>
          <a href="#setup" class="nav-link">Initial Setup</a>
          <a href="#create-merchant" class="nav-link nav-link-sub">Create Merchant</a>
          <a href="#create-account" class="nav-link nav-link-sub">Create Account</a>
        </nav>

        <nav class="nav-section">
          <div class="nav-section-title">Escrow Flow</div>
          <a href="#flow" class="nav-link">Complete Flow</a>
          <a href="#payoneer-flow" class="nav-link nav-link-sub">International Payment</a>
          <a href="#payment-success" class="nav-link nav-link-sub">Confirm Funds</a>
          <a href="#release-funds" class="nav-link nav-link-sub">Release Funds</a>
          <a href="#payout-webhook" class="nav-link nav-link-sub">Payout Webhook</a>
        </nav>

        <nav class="nav-section">
          <div class="nav-section-title">Reference</div>
          <a href="#refund" class="nav-link">Refund Flow</a>
          <a href="#webhooks" class="nav-link">Webhooks</a>
          <a href="#errors" class="nav-link">Error Handling</a>
          <a href="#endpoints" class="nav-link">API Endpoints</a>
          <a href="#swot" class="nav-link">SWOT Analysis</a>
          <a href="#best-practices" class="nav-link">Best Practices</a>
        </nav>
      </aside>

      <!-- Main Content -->
      <main class="main">
        <div class="container">
          <!-- Header -->
          <header style="margin-bottom: 40px; border-bottom: 4px solid var(--border-strong); padding-bottom: 30px;">
            <h1>Escrow API Documentation</h1>
            <p class="intro">
              Complete API flow for building an Upwork-like freelance marketplace with secure escrow payments using NextPay Partners API.
            </p>

            <div class="api-info" id="authentication">
              <div class="api-info-row">
                <span class="api-info-label">Base URL</span>
                <span class="api-info-value">https://api.partners.nextpay.world</span>
              </div>
              <div class="api-info-row">
                <span class="api-info-label">API Version</span>
                <span class="api-info-value">v1</span>
              </div>
              <div class="api-info-row">
                <span class="api-info-label">Authentication</span>
                <span class="api-info-value">Basic Auth (Client ID:Client Secret → Base64)</span>
              </div>
              <div class="api-info-row">
                <span class="api-info-label">Currency</span>
                <span class="api-info-value">PHP (amounts in cents)</span>
              </div>
            </div>
          </header>

          <!-- Platform Overview -->
          <section id="overview">
            <h2>Platform Overview</h2>
            <p>
              This documentation outlines how to build an escrow-based freelance marketplace (similar to Upwork) using the NextPay Partners API. The platform connects <strong>Clients</strong> (employers) with <strong>Talents</strong> through secure payment protection.
            </p>

            <div class="section-card">
              <div class="section-card-title">How Escrow Works</div>
              <ul>
                <li>Client deposits payment into an escrow account before work begins</li>
                <li>Funds are held securely until the job is completed</li>
                <li>Upon approval, funds are released to the talent</li>
                <li>If disputes arise, funds can be refunded to the client</li>
              </ul>
            </div>

            <div class="section-card">
              <div class="section-card-title">Trial Period System</div>
              <p>Our platform offers flexible trial periods to help clients evaluate talents before committing to long-term engagements:</p>
              <ul>
                <li><strong>30-Day Trial:</strong> Short-term evaluation for quick projects or initial assessment</li>
                <li><strong>60-Day Trial:</strong> Standard trial period for medium-complexity projects</li>
                <li><strong>90-Day Trial:</strong> Extended evaluation for complex, long-term engagements</li>
              </ul>
              <p style="margin-bottom: 0">During the trial period, clients can assess the talent's performance, communication, and deliverables. At the end of the trial, clients can choose to continue working with the talent on a permanent basis or end the engagement.</p>
            </div>

            <div class="section-card">
              <div class="section-card-title">Payment Gateway Integration</div>
              <p>Our platform is designed for <strong>foreign clients</strong> hiring <strong>Filipino talents</strong>. Here's the recommended payment stack:</p>
              
              <!-- Simple Flow -->
              <div style="border: 2px solid #000; padding: 16px; margin: 16px 0;">
                <div style="font-size: 0.75rem; font-weight: 600; text-transform: uppercase; letter-spacing: 0.1em; margin-bottom: 12px;">Recommended Stack</div>
                <div style="display: flex; align-items: center; gap: 8px; flex-wrap: wrap; font-family: 'JetBrains Mono', monospace; font-size: 0.9rem;">
                  <span style="background: #000; color: #fff; padding: 6px 12px;">Payoneer</span>
                  <span>→</span>
                  <span style="border: 1px solid #000; padding: 6px 12px;">USD/EUR to PHP</span>
                  <span>→</span>
                  <span style="background: #000; color: #fff; padding: 6px 12px;">NextPay</span>
                  <span>→</span>
                  <span style="border: 1px solid #000; padding: 6px 12px;">Talent Bank</span>
                </div>
              </div>

              <h4 style="margin-top: 20px; margin-bottom: 8px;">Step 1: Receive International Payments</h4>
              <table style="margin-bottom: 16px;">
                <thead>
                  <tr>
                    <th>Provider</th>
                    <th>Role</th>
                    <th>Why</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td><strong>Payoneer</strong></td>
                    <td>Collect USD/EUR from foreign clients, convert to PHP</td>
                    <td>Trusted by Upwork, Fiverr, 2,000+ marketplaces</td>
                  </tr>
                </tbody>
              </table>

              <h4 style="margin-bottom: 8px;">Step 2: Escrow & Payout (Philippines)</h4>
              <table style="margin-bottom: 16px;">
                <thead>
                  <tr>
                    <th>Provider</th>
                    <th>Role</th>
                    <th>Why</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td><strong>NextPay</strong></td>
                    <td>Hold PHP in escrow, payout via InstaPay/PESONet</td>
                    <td>BSP-regulated, instant local transfers</td>
                  </tr>
                </tbody>
              </table>

              <div style="background: #f4f4f4; border-left: 3px solid #000; padding: 12px; margin-top: 8px;">
                <strong>Flow:</strong> Client pays USD/EUR (Payoneer) → Convert & transfer to PHP → Hold in escrow (NextPay) → Release to talent bank.
              </div>
            </div>
          </section>

          <!-- Core Entities -->
          <section id="entities">
            <h2>Core Entities</h2>
            <p>Understanding the key entities in the NextPay API:</p>

            <div class="entity-grid">
              <div class="entity-card">
                <div class="entity-title">Partner</div>
                <div class="entity-desc">Your platform. Integrates with NextPay and manages merchants/accounts.</div>
              </div>
              <div class="entity-card">
                <div class="entity-title">Merchant</div>
                <div class="entity-desc">A verified user (Client or Talent) who can receive settlements.</div>
              </div>
              <div class="entity-card">
                <div class="entity-title">Account</div>
                <div class="entity-desc">A financial wallet that holds funds. Can be partner-owned or merchant-owned.</div>
              </div>

              <div class="entity-card">
                <div class="entity-title">Payout Request</div>
                <div class="entity-desc">A request to disburse funds to a bank account (money-out).</div>
              </div>
              <div class="entity-card">
                <div class="entity-title">Transaction</div>
                <div class="entity-desc">A ledger record tracking all fund movements between accounts.</div>
              </div>
            </div>
          </section>

          <!-- Initial Setup -->
          <section id="setup">
            <h2>Initial Setup</h2>

            <div id="create-merchant">
              <h4>Step 1: Create a Merchant for the Talent</h4>
              <p>When a talent registers on your platform, create a merchant to enable payouts:</p>

              <h3>Endpoint</h3>
              <div class="endpoint"><span class="method method-post">POST</span>/v1/merchants</div>

              <h3>Request Body</h3>
              <div class="code-block">{
  "display_name": "John Doe Talent",
  "legal_name": "John Doe",
  "external_id": "talent_001",
  "legal_address": {
    "line1": "123 Main Street",
    "city": "Manila",
    "country": "PH"
  },
  "settlement_account": {
    "bank_account_name": "John Doe",
    "bank_account_number": "1234567890",
    "bank_code": "BOPIPHMMXXX",
    "preferred_settlement_rail": "instapay"
  }
}</div>

              <h3>Response</h3>
              <div class="code-block">{
  "id": "merchant_abc123",
  "display_name": "John Doe Talent",
  "external_id": "talent_001",
  "legal_entity_id": "le_xyz789",
  "bank_account_name": "John Doe",
  "bank_account_number": "1234567890",
  "bank_code_instapay": "BOPIPHMMXXX"
}</div>
            </div>

            <div id="create-account">
              <h4>Step 2: Create Escrow Account for Each Contract</h4>
              <p>For each job contract, create a dedicated escrow account to hold funds:</p>

              <h3>Endpoint</h3>
              <div class="endpoint"><span class="method method-post">POST</span>/v1/accounts</div>

              <h3>Request Body</h3>
              <div class="code-block">{
  "display_name": "Escrow - Website Development",
  "external_id": "contract_ORD-1001"
}</div>

              <h3>Response</h3>
              <div class="code-block">{
  "id": "acc_escrow_123",
  "display_name": "Escrow - Website Development",
  "external_id": "contract_ORD-1001",
  "merchant_id": null
}</div>
            </div>
          </section>

          <!-- Escrow Flow -->
          <section id="flow">
            <h2>Complete Escrow Flow</h2>

            <div class="flow-visual">
              <!-- Phase 1: Platform -->
              <div class="flow-step">
                <div class="flow-box">1. Client creates a job post<br><small style="font-weight: normal; opacity: 0.7;">(objectives, budget, trial: 30/60/90 days)</small></div>
                <div class="flow-arrow">↓</div>
              </div>
              <div class="flow-step">
                <div class="flow-box">2. Track applications & choose candidate</div>
                <div class="flow-arrow">↓</div>
              </div>
              <div class="flow-step">
                <div class="flow-box">3. Client sends offer → Talent accepts</div>
                <div class="flow-arrow">↓</div>
              </div>

              <!-- Phase 2: Payoneer Collection -->
              <div class="flow-step">
                <div class="flow-box" style="background: #fff0f6; border-color: #ec4899;">
                  <span style="background: #ec4899; color: #fff; font-size: 0.65rem; padding: 2px 6px; border-radius: 3px; margin-right: 8px;">PAYONEER</span>
                  4. Client pays in USD/EUR<br>
                  <small style="font-weight: normal; opacity: 0.7;">Hosted checkout → payment.charged webhook</small>
                </div>
                <div class="flow-arrow">↓</div>
              </div>
              <div class="flow-step">
                <div class="flow-box" style="border-style: dashed; background: #fefce8;">
                  <span style="background: #eab308; color: #fff; font-size: 0.65rem; padding: 2px 6px; border-radius: 3px; margin-right: 8px;">AUTO</span>
                  5. Transfer to PH bank<br>
                  <small style="font-weight: normal; opacity: 0.7;">Payoneer API or unified gateway</small>
                </div>
                <div class="flow-arrow">↓</div>
              </div>

              <!-- Phase 3: NextPay Escrow -->
              <div class="flow-step">
                <div class="flow-box holding">
                  <span style="background: #fff; color: #000; font-size: 0.65rem; padding: 2px 6px; border-radius: 3px; margin-right: 8px;">NEXTPAY</span>
                  6. Funds held in escrow<br>
                  <small style="font-weight: normal; opacity: 0.7;">deposit.confirmed webhook → Trial period starts</small>
                </div>
                <div class="flow-arrow">↓</div>
              </div>

              <!-- Phase 4: Work & Approval -->
              <div class="flow-step">
                <div class="flow-box">7. Trial period → Talent delivers work</div>
                <div class="flow-arrow">↓</div>
              </div>
              <div class="flow-step">
                <div class="flow-box">8. Client reviews & decides</div>
                <div class="flow-arrow">↓</div>
              </div>
              
              <!-- Branching paths -->
              <div style="display: flex; gap: 30px; justify-content: center; margin: 8px 0;">
                <div style="text-align: center;">
                  <div class="flow-box" style="background: #f0fdf4; border-color: #22c55e; min-width: 160px;"><span style="color: #16a34a;">✓</span> Approved</div>
                  <div class="flow-arrow">↓</div>
                  <div class="flow-box" style="min-width: 160px;">Release payment</div>
                </div>
                <div style="text-align: center;">
                  <div class="flow-box" style="background: #fefce8; border-color: #eab308; min-width: 160px;"><span style="color: #ca8a04;">!</span> Disputed</div>
                  <div class="flow-arrow">↓</div>
                  <div class="flow-box" style="min-width: 160px;">Refund or split</div>
                </div>
              </div>
              
              <div class="flow-arrow">↓</div>

              <!-- Phase 5: NextPay Payout -->
              <div class="flow-step">
                <div class="flow-box holding">
                  <span style="background: #fff; color: #000; font-size: 0.65rem; padding: 2px 6px; border-radius: 3px; margin-right: 8px;">NEXTPAY</span>
                  9. Payout to talent bank<br>
                  <small style="font-weight: normal; opacity: 0.7;">POST /v1/payout-requests → InstaPay/PESONet</small>
                </div>
                <div class="flow-arrow">↓</div>
              </div>
              <div class="flow-step">
                <div class="flow-box webhook">10. payout.succeeded (Webhook)</div>
                <div class="flow-arrow">↓</div>
              </div>
              <div class="flow-step">
                <div class="flow-box" style="background: #f0fdf4; border-color: #22c55e;">✓ Contract Complete</div>
              </div>
            </div>

            <!-- API Quick Reference -->
            <div class="section-card" style="margin-top: 30px;">
              <div class="section-card-title">API Quick Reference</div>
              <table>
                <thead>
                  <tr>
                    <th style="width: 50px;">Step</th>
                    <th style="width: 90px;">Provider</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td>1-3</td>
                    <td>Platform</td>
                    <td>Job post → Offer → Accept</td>
                  </tr>
                  <tr>
                    <td>4</td>
                    <td><strong style="color: #ec4899;">Payoneer</strong></td>
                    <td><code class="code-inline">POST /api/lists</code> → Hosted checkout</td>
                  </tr>
                  <tr>
                    <td>5</td>
                    <td><strong style="color: #eab308;">Auto</strong></td>
                    <td>Payoneer API → PH bank (see options below)</td>
                  </tr>
                  <tr>
                    <td>6</td>
                    <td><strong>NextPay</strong></td>
                    <td><code class="code-inline">deposit.confirmed</code> webhook → Escrow funded</td>
                  </tr>
                  <tr>
                    <td>7-8</td>
                    <td>Platform</td>
                    <td>Trial period → Client approval</td>
                  </tr>
                  <tr>
                    <td>9</td>
                    <td><strong>NextPay</strong></td>
                    <td><code class="code-inline">POST /v1/payout-requests</code> → Release</td>
                  </tr>
                  <tr>
                    <td>10</td>
                    <td><strong>NextPay</strong></td>
                    <td><code class="code-inline">payout.succeeded</code> webhook → Complete</td>
                  </tr>
                </tbody>
              </table>
            </div>

            <!-- Step 3: International Payment (Payoneer) -->
            <div id="payoneer-flow">
              <h4>Step 3: Collect International Payment (Payoneer Checkout)</h4>
              <p>For foreign clients (USD/EUR), use the <strong>Payoneer Checkout API</strong> to generate a hosted payment page. This allows clients to pay safely via Card or Bank Transfer.</p>

              <div class="api-info" style="margin: 0 0 20px; padding: 16px;">
                <div class="api-info-row">
                  <span class="api-info-label">Provider API</span>
                  <span class="api-info-value">https://api.live.oscato.com/api/lists</span>
                </div>
                <div class="api-info-row">
                  <span class="api-info-label">Auth</span>
                  <span class="api-info-value">Basic Auth (Merchant Code : API Token)</span>
                </div>
              </div>

              <h3>1. Create Payment Session</h3>
              <div class="endpoint"><span class="method method-post">POST</span>/api/lists</div>

              <h3>Request Body</h3>
              <div class="code-block">{
  "transactionId": "ORD-1001-PAYMENT",
  "integration": "HOSTED",
  "country": "US",
  "payment": {
    "amount": 3000.00,
    "currency": "USD",
    "reference": "Contract #1001"
  },
  "style": {
    "language": "en"
  },
  "callback": {
    "returnUrl": "https://your-platform.com/checkout/success",
    "cancelUrl": "https://your-platform.com/checkout/cancel",
    "notificationUrl": "https://your-platform.com/webhooks/payoneer"
  }
}</div>

              <h3>Response</h3>
              <div class="code-block">{
  "links": {
    "self": "https://api.live.oscato.com/api/lists/LIST-123abc456",
    "redirect": "https://checkout.payoneer.com/payment/LIST-123abc456"
  },
  "resultInfo": "Payment session created successfully"
}</div>

              <div class="section-card">
                <div class="section-card-title">2. Redirect Client</div>
                <p>Redirect the client's browser to the <code>links.redirect</code> URL from the response. They will complete the payment on Payoneer's secure hosted page.</p>
              </div>

              <div class="section-card">
                <div class="section-card-title">3. Handle Payment Notification (Webhook)</div>
                <p>Payoneer sends an asynchronous notification to your <code>notificationUrl</code> when the payment status changes.</p>
                
                <h3>Payload (CHARGED)</h3>
                <div class="code-block">{
  "interaction": {
    "code": "PROCEED",
    "reason": "OK"
  },
  "payment": {
    "reference": "Contract #1001",
    "amount": 3000.00,
    "currency": "USD"
  },
  "transactionId": "ORD-1001-PAYMENT",
  "resultInfo": "Transaction succeeded"
}</div>

              <!-- Automation Options -->
              <div class="section-card" style="border: 2px solid #000; background: #fff;">
                <div class="section-card-title">4. Transfer to NextPay Escrow — Automation Options</div>
                <p>As your platform scales, manual transfers become a bottleneck. Here are <strong>3 automation strategies</strong>:</p>

                <!-- Option A: Payoneer API -->
                <h4 style="margin-top: 20px; margin-bottom: 8px;">Option A: Payoneer Withdrawal API (Recommended for Payoneer users)</h4>
                <p>Use Payoneer's <strong>Withdraw API</strong> to programmatically transfer funds to your PH bank account:</p>
                
                <div class="endpoint"><span class="method method-post">POST</span>https://api.payoneer.com/v4/programs/{program_id}/payees/{payee_id}/withdraw</div>
                
                <div class="code-block">{
  "payee_id": "your_platform_payee_id",
  "amount": 3000.00,
  "currency": "USD",
  "destination": {
    "type": "bank_account",
    "bank_account_id": "ba_philippines_001"
  },
  "client_reference_id": "ORD-1001-WITHDRAWAL"
}</div>

                <div style="background: #f0fdf4; border: 1px solid #22c55e; border-radius: 8px; padding: 12px; margin: 12px 0;">
                  <strong>✓ Benefit:</strong> Fully automated withdrawal triggered by your backend when <code>payment.charged</code> webhook is received.
                </div>

                <!-- Option B: Unified Gateway -->
                <h4 style="margin-top: 24px; margin-bottom: 8px;">Option B: Unified Gateway (Best for Scale)</h4>
                <p>Replace Payoneer + NextPay with a <strong>single gateway</strong> that handles both international collection AND PHP payout:</p>
                
                <table style="margin: 12px 0;">
                  <thead>
                    <tr>
                      <th>Provider</th>
                      <th>International</th>
                      <th>PHP Payout</th>
                      <th>Escrow</th>
                      <th>Best For</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr>
                      <td><strong>Xendit</strong></td>
                      <td>✓ 130+ countries</td>
                      <td>✓ InstaPay</td>
                      <td>✓ Hold funds</td>
                      <td>SEA marketplaces</td>
                    </tr>
                    <tr>
                      <td><strong>Wise Business</strong></td>
                      <td>✓ 80+ currencies</td>
                      <td>✓ InstaPay (instant)</td>
                      <td>✗ External</td>
                      <td>Fast transfers</td>
                    </tr>
                    <tr>
                      <td><strong>Rapyd</strong></td>
                      <td>✓ 100+ countries</td>
                      <td>✓ Local rails</td>
                      <td>✓ Virtual accounts</td>
                      <td>Global expansion</td>
                    </tr>
                    <tr>
                      <td><strong>HitPay</strong></td>
                      <td>✓ 150 currencies</td>
                      <td>✓ PHP bank</td>
                      <td>✓ Split payments</td>
                      <td>Easy integration</td>
                    </tr>
                  </tbody>
                </table>

                <div style="background: #dbeafe; border: 1px solid #3b82f6; border-radius: 8px; padding: 12px; margin: 12px 0;">
                  <strong>✓ Benefit:</strong> Single API for collection + payout. No currency conversion delays. Example with Xendit:
                </div>

                <div class="code-block">// Xendit: Collect USD, payout PHP - single API
// 1. Create invoice (USD)
POST /v2/invoices
{ "external_id": "ORD-1001", "amount": 3000, "currency": "USD" }

// 2. When paid, create disbursement (PHP)
POST /xendit/disbursements
{ "external_id": "ORD-1001-PAYOUT", "amount": 168000, "currency": "PHP",
  "bank_code": "BPI", "account_holder_name": "John Doe",
  "account_number": "1234567890" }</div>

                <!-- Option C: Keep NextPay + Automate Payoneer -->
                <h4 style="margin-top: 24px; margin-bottom: 8px;">Option C: Keep Current Stack + Auto-Withdrawal</h4>
                <p>If you want to keep Payoneer + NextPay, automate the withdrawal:</p>
                
                <ul>
                  <li><strong>Payoneer Balance Webhook:</strong> Listen for <code>balance.available</code> event</li>
                  <li><strong>Trigger Withdrawal API:</strong> Automatically call withdraw endpoint</li>
                  <li><strong>NextPay Deposit Webhook:</strong> Detect when funds arrive via <code>deposit.confirmed</code></li>
                </ul>

                <div class="code-block">// Automated flow in your backend:
app.post('/webhooks/payoneer/balance', (req, res) => {
  if (req.body.event === 'balance.available') {
    // Auto-trigger withdrawal to PH bank
    await payoneerAPI.withdraw({
      amount: req.body.available_balance,
      destination: 'ba_nextpay_account'
    });
  }
});

app.post('/webhooks/nextpay/deposit', (req, res) => {
  if (req.body.webhook_event_type === 'deposit.confirmed') {
    // Match to contract, mark as funded
    await updateContractStatus(req.body.reference, 'funded');
  }
});</div>

                <!-- Comparison -->
                <h4 style="margin-top: 24px; margin-bottom: 8px;">Which Option to Choose?</h4>
                <table>
                  <thead>
                    <tr>
                      <th>Platform Stage</th>
                      <th>Recommended</th>
                      <th>Why</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr>
                      <td><strong>Starting out</strong> (&lt;50 tx/mo)</td>
                      <td>Option C (Auto-Withdrawal)</td>
                      <td>Keep Payoneer brand trust, low setup</td>
                    </tr>
                    <tr>
                      <td><strong>Growing</strong> (50-500 tx/mo)</td>
                      <td>Option A (Payoneer API)</td>
                      <td>Full automation, existing relationships</td>
                    </tr>
                    <tr>
                      <td><strong>Scaling</strong> (500+ tx/mo)</td>
                      <td>Option B (Xendit/Rapyd)</td>
                      <td>Single API, faster transfers, lower fees</td>
                    </tr>
                  </tbody>
                </table>
              </div>

              <div class="section-card" style="background: linear-gradient(135deg, #dbeafe 0%, #bfdbfe 100%); border: 2px solid #3b82f6;">
                <div class="section-card-title"><svg style="width: 16px; height: 16px; vertical-align: middle; margin-right: 4px;" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9"></path></svg> 5. Detect Deposit in NextPay (Automated)</div>
                <p>Listen for the <code>deposit.confirmed</code> webhook to automatically detect when Payoneer funds arrive in your NextPay escrow account.</p>
                
                <h3>Webhook Payload</h3>
                <div class="code-block">{
  "webhook_event_type": "deposit.confirmed",
  "id": "dep_abc123",
  "account_id": "acc_escrow_123",
  "amount_cents": 168000,
  "currency": "PHP",
  "source": "bank_transfer",
  "reference": "PAYONEER-WD-789456",
  "confirmed_at": "2024-12-15T10:30:00Z"
}</div>
                
                <h3 style="margin-top: 16px;">Your Backend Action</h3>
                <ul style="margin: 0;">
                  <li><strong>Match Reference:</strong> Link the deposit to the original contract using the reference or amount</li>
                  <li><strong>Update Contract:</strong> Mark status as <span class="status-badge status-funded">funded</span></li>
                  <li><strong>Notify Talent:</strong> Inform talent that funds are secured and work can begin</li>
                  <li><strong>Start Trial:</strong> Begin the trial period countdown (30/60/90 days)</li>
                </ul>
              </div>
            </div>

            <!-- Step 6: Confirm Funds (Alternative - Polling) -->
            <div id="payment-success">
              <h4>Step 6: Confirm Funds (Polling Method)</h4>
              <p>While the <code>deposit.confirmed</code> webhook (Step 5 above) is the <strong>recommended primary method</strong>, you can also use polling as a backup to verify funds have arrived in the escrow account.</p>

              <div style="background: #fef3c7; border: 1px solid #f59e0b; border-radius: 8px; padding: 12px; margin-bottom: 16px;">
                <strong><svg style="width: 14px; height: 14px; vertical-align: middle; margin-right: 4px;" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"></path></svg> Note:</strong> Use polling only as a backup if webhooks fail. Primary detection should be via <code>deposit.confirmed</code> webhook for real-time updates.
              </div>

              <h3>Endpoint</h3>
              <div class="endpoint"><span class="method method-get">GET</span>/v1/accounts/{id}/balance</div>

              <h3>Response</h3>
              <div class="code-block">{
  "available_balance": {
    "PHP": {
      "amount_cents": 168000,
      "currency": "PHP"
    }
  },
  "current_balance": {
    "PHP": {
      "amount_cents": 168000,
      "currency": "PHP"
    }
  }
}</div>

              <div class="section-card">
                <div class="section-card-title">Polling Strategy</div>
                <ul style="margin: 0">
                  <li><strong>Frequency:</strong> Check every 15-30 minutes during expected arrival window</li>
                  <li><strong>Timeout:</strong> Stop polling after 7 business days (max transfer time)</li>
                  <li><strong>Comparison:</strong> Compare balance before/after to detect new deposits</li>
                  <li><strong>Fallback:</strong> Alert admin if funds not detected within expected timeframe</li>
                </ul>
              </div>
            </div>


            <!-- Step 7: Release Funds -->
            <div id="release-funds">
              <h4>Step 7: Release Funds to Talent</h4>
              <p>When the client approves the completed work, create a payout request:</p>

              <h3>Endpoint</h3>
              <div class="endpoint"><span class="method method-post">POST</span>/v1/payout-requests</div>

              <h3>Request Body</h3>
              <div class="code-block">{
  "source_account_id": "acc_escrow_123",
  "amount_cents": 142500,
  "currency": "PHP",
  "status": "published",
  "settlement_rail": "instapay",
  "external_id": "payout-ORD-1001",
  "label": "Contract Payment - Website Development",
  "description": "Payment for completed website development work",
  "payout_memo": "Thank you for your work!",
  "settlement_account": {
    "bank_account_name": "John Doe",
    "bank_account_number": "1234567890",
    "bank_code": "BOPIPHMMXXX"
  },
  "partner_payout_fee": {
    "amount_cents": 7500,
    "destination_account_id": "acc_platform_fees"
  }
}</div>

              <div class="section-card">
                <div class="section-card-title">Platform Fee Calculation</div>
                <p style="margin-bottom: 8px">Example with 5% platform fee:</p>
                <ul style="margin: 0">
                  <li>Contract Amount: P1,500.00 (150000 cents)</li>
                  <li>Platform Fee (5%): P75.00 (7500 cents)</li>
                  <li>Talent Receives: P1,425.00 (142500 cents)</li>
                </ul>
              </div>

              <h3>Response</h3>
              <div class="code-block">{
  "id": "pr_xyz789",
  "source_account_id": "acc_escrow_123",
  "amount_cents": 142500,
  "currency": "PHP",
  "status": "queued",
  "external_id": "payout-ORD-1001",
  "settlement_rail": "instapay",
  "payouts": [
    {
      "id": "payout_001",
      "amount_cents": 142500,
      "status": "processing"
    }
  ]
}</div>
            </div>

            <!-- Payout Webhook -->
            <div id="payout-webhook">
              <h4>Step 8: Handle Payout Confirmation</h4>
              <p>Listen for payout webhooks to confirm successful transfer:</p>

              <h3>Webhook Payload</h3>
              <div class="code-block">{
  "webhook_event_type": "payout.succeeded",
  "id": "payout_001",
  "payout_request_id": "pr_xyz789",
  "amount_cents": 142500,
  "fee_cents": 1500,
  "currency": "PHP",
  "status": "succeeded",
  "bank_account_name": "John Doe",
  "bank_account_number": "******7890",
  "settlement_rail": "instapay",
  "receipt": {
    "receipt_id": "rcpt_po_abc",
    "treasury_reference_no": "TREF_PO_7788"
  }
}</div>

              <h3>Your Backend Action</h3>
              <ul>
                <li>Update contract status to <span class="status-badge status-released">released</span></li>
                <li>Clear escrow account</li>
                <li>Notify talent of successful payment</li>
                <li>Close the contract</li>
              </ul>
            </div>
          </section>

          <!-- Refund Flow -->
          <section id="refund">
            <h2>Refund Flow</h2>
            <p>If a dispute is resolved in favor of the client, refund the escrow funds:</p>

            <h3>Endpoint</h3>
            <div class="endpoint"><span class="method method-post">POST</span>/v1/payout-requests</div>

            <h3>Request Body</h3>
            <div class="code-block">{
  "source_account_id": "acc_escrow_123",
  "amount_cents": 150000,
  "currency": "PHP",
  "status": "published",
  "settlement_rail": "instapay",
  "external_id": "refund-ORD-1001",
  "label": "Refund - Contract Cancelled",
  "payout_memo": "Contract cancelled - full refund",
  "settlement_account": {
    "bank_account_name": "Client Name",
    "bank_account_number": "9876543210",
    "bank_code": "BNORPHM1XXX"
  }
}</div>

            <p>After successful payout, update contract status to <span class="status-badge status-refunded">refunded</span>.</p>
          </section>

          <!-- Webhooks -->
          <section id="webhooks">
            <h2>Webhook Events</h2>
            <p>Register a webhook endpoint to receive real-time event notifications:</p>

            <h3>Endpoint</h3>
            <div class="endpoint"><span class="method method-post">POST</span>/v1/webhooks</div>

            <h3>Payment Intent Events</h3>
            <div class="webhook-list">
              <div class="webhook-item">
                <span class="webhook-event">payment_intent.created</span>
                <span class="webhook-desc">Payment intent was successfully created</span>
              </div>
              <div class="webhook-item">
                <span class="webhook-event">payment_intent.succeeded</span>
                <span class="webhook-desc">Payment completed successfully - funds credited to account</span>
              </div>
              <div class="webhook-item">
                <span class="webhook-event">payment_intent.failed</span>
                <span class="webhook-desc">Payment attempt failed (insufficient funds, declined, etc.)</span>
              </div>
              <div class="webhook-item">
                <span class="webhook-event">payment_intent.expired</span>
                <span class="webhook-desc">Payment intent expired before completion</span>
              </div>
              <div class="webhook-item">
                <span class="webhook-event">payment_intent.canceled</span>
                <span class="webhook-desc">Payment intent was explicitly canceled</span>
              </div>
            </div>

            <h3>Payout Events</h3>
            <div class="webhook-list">
              <div class="webhook-item">
                <span class="webhook-event">payout_request.queued</span>
                <span class="webhook-desc">Payout request accepted and queued for processing</span>
              </div>
              <div class="webhook-item">
                <span class="webhook-event">payout.succeeded</span>
                <span class="webhook-desc">Payout completed - funds transferred to recipient</span>
              </div>
              <div class="webhook-item">
                <span class="webhook-event">payout.failed</span>
                <span class="webhook-desc">Payout failed - check failure_reason for details</span>
              </div>
            </div>

            <h3>Deposit Events</h3>
            <div class="webhook-list">
              <div class="webhook-item">
                <span class="webhook-event">deposit.confirmed</span>
                <span class="webhook-desc">Direct deposit confirmed and credited to account</span>
              </div>
              <div class="webhook-item">
                <span class="webhook-event">direct_transfer.received</span>
                <span class="webhook-desc">Transfer received from another account</span>
              </div>
            </div>
          </section>

          <!-- Error Handling -->
          <section id="errors">
            <h2>Error Handling</h2>
            <table>
              <thead>
                <tr>
                  <th>Scenario</th>
                  <th>Status</th>
                  <th>Action</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>Payment failed</td>
                  <td><span class="status-badge status-failed">failed</span></td>
                  <td>Show error to client, allow retry</td>
                </tr>
                <tr>
                  <td>Payment expired</td>
                  <td><span class="status-badge status-pending">expired</span></td>
                  <td>Create new payment intent</td>
                </tr>
                <tr>
                  <td>Payout failed</td>
                  <td><span class="status-badge status-failed">failed</span></td>
                  <td>Flag for manual review, verify bank details</td>
                </tr>
                <tr>
                  <td>Insufficient balance</td>
                  <td><span class="status-badge status-failed">failed</span></td>
                  <td>Check account balance before payout</td>
                </tr>
                <tr>
                  <td>Rate limit exceeded</td>
                  <td>HTTP 429</td>
                  <td>Implement exponential backoff</td>
                </tr>
                <tr>
                  <td>Duplicate request</td>
                  <td>Idempotent</td>
                  <td>Use X-Idempotency-Key header</td>
                </tr>
              </tbody>
            </table>
          </section>

          <!-- API Reference Summary -->
          <section id="endpoints">
            <h2>API Endpoints Summary</h2>
            <table>
              <thead>
                <tr>
                  <th>Endpoint</th>
                  <th>Method</th>
                  <th>Description</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td><code class="code-inline">/v1/merchants</code></td>
                  <td><span class="method method-post">POST</span><span class="method method-get">GET</span></td>
                  <td>Create and list merchants</td>
                </tr>
                <tr>
                  <td><code class="code-inline">/v1/merchants/:id</code></td>
                  <td><span class="method method-get">GET</span><span class="method method-patch">PATCH</span></td>
                  <td>Get and update merchant</td>
                </tr>
                <tr>
                  <td><code class="code-inline">/v1/accounts</code></td>
                  <td><span class="method method-post">POST</span><span class="method method-get">GET</span></td>
                  <td>Create and list accounts</td>
                </tr>
                <tr>
                  <td><code class="code-inline">/v1/accounts/:id</code></td>
                  <td><span class="method method-get">GET</span><span class="method method-patch">PATCH</span></td>
                  <td>Get and update account</td>
                </tr>
                <tr>
                  <td><code class="code-inline">/v1/accounts/:id/balance</code></td>
                  <td><span class="method method-get">GET</span></td>
                  <td>Get account balance</td>
                </tr>
                <tr>
                  <td><code class="code-inline">/v1/payment-intents</code></td>
                  <td><span class="method method-post">POST</span><span class="method method-get">GET</span></td>
                  <td>Create and list payment intents</td>
                </tr>
                <tr>
                  <td><code class="code-inline">/v1/payment-intents/:id</code></td>
                  <td><span class="method method-get">GET</span></td>
                  <td>Get payment intent details</td>
                </tr>
                <tr>
                  <td><code class="code-inline">/v1/payment-intents/:id/cancel</code></td>
                  <td><span class="method method-post">POST</span></td>
                  <td>Cancel payment intent</td>
                </tr>
                <tr>
                  <td><code class="code-inline">/v1/payout-requests</code></td>
                  <td><span class="method method-post">POST</span><span class="method method-get">GET</span></td>
                  <td>Create and list payout requests</td>
                </tr>
                <tr>
                  <td><code class="code-inline">/v1/payout-requests/:id</code></td>
                  <td><span class="method method-get">GET</span></td>
                  <td>Get payout request details</td>
                </tr>
                <tr>
                  <td><code class="code-inline">/v1/receiving_institutions</code></td>
                  <td><span class="method method-get">GET</span></td>
                  <td>List supported banks</td>
                </tr>
                <tr>
                  <td><code class="code-inline">/v1/webhooks</code></td>
                  <td><span class="method method-post">POST</span><span class="method method-get">GET</span></td>
                  <td>Register and list webhooks</td>
                </tr>
              </tbody>
            </table>
          </section>

          <!-- SWOT Analysis -->
          <section id="swot">
            <h2>SWOT Analysis</h2>
            <p>Strategic assessment of the Payoneer + NextPay escrow payment integration for freelance marketplaces:</p>

            <div style="display: flex; flex-direction: column; gap: 20px;">
              <!-- Strengths -->
              <div class="entity-card" style="border-width: 1px;">
                <div class="entity-title" style="color: #15803d;">Strengths</div>
                <ul style="border: none; padding-left: 0; margin: 12px 0 0 0;">
                  <li style="margin-bottom: 8px;"><strong>BSP-Regulated:</strong> NextPay is BSP-regulated, ensuring compliance and trust for Philippine operations</li>
                  <li style="margin-bottom: 8px;"><strong>Proven Stack:</strong> Payoneer trusted by Upwork, Fiverr, and 2,000+ marketplaces globally</li>
                  <li style="margin-bottom: 8px;"><strong>Instant Local Payouts:</strong> InstaPay/PESONet integration enables real-time PHP transfers to talent bank accounts</li>
                  <li style="margin-bottom: 8px;"><strong>Flexible Trial Periods:</strong> 30/60/90-day trial system provides evaluation flexibility for clients</li>
                  <li style="margin-bottom: 8px;"><strong>Comprehensive Webhooks:</strong> Real-time event notifications for payment lifecycle tracking</li>
                  <li style="margin-bottom: 0;"><strong>Platform Fee Support:</strong> Built-in partner fee deduction during payout</li>
                </ul>
              </div>

              <!-- Weaknesses -->
              <div class="entity-card" style="border-width: 1px;">
                <div class="entity-title" style="color: #b91c1c;">Weaknesses</div>
                <ul style="border: none; padding-left: 0; margin: 12px 0 0 0;">
                  <li style="margin-bottom: 8px;"><strong>Transfer Delays:</strong> 2-6 business day delay for Payoneer → PH bank transfers</li>
                  <li style="margin-bottom: 8px;"><strong>Dual Integration:</strong> Requires maintaining two separate API integrations (Payoneer + NextPay)</li>
                  <li style="margin-bottom: 8px;"><strong>Currency Conversion:</strong> FX rates and timing add complexity to amount reconciliation</li>
                  <li style="margin-bottom: 8px;"><strong>PHP Only:</strong> NextPay limited to PHP currency for escrow and payouts</li>
                  <li style="margin-bottom: 8px;"><strong>Manual Bridge:</strong> Without automation, Payoneer → NextPay transfer requires manual intervention</li>
                  <li style="margin-bottom: 0;"><strong>Limited Dispute Resolution:</strong> No built-in arbitration system; disputes handled externally</li>
                </ul>
              </div>

              <!-- Opportunities -->
              <div class="entity-card" style="border-width: 1px;">
                <div class="entity-title" style="color: #1d4ed8;">Opportunities</div>
                <ul style="border: none; padding-left: 0; margin: 12px 0 0 0;">
                  <li style="margin-bottom: 8px;"><strong>Unified Gateway Migration:</strong> Xendit/Rapyd can replace dual-provider setup at scale (500+ tx/mo)</li>
                  <li style="margin-bottom: 8px;"><strong>EOR Expansion:</strong> Transition to Employer of Record model with statutory benefits (SSS, PhilHealth, Pag-IBIG)</li>
                  <li style="margin-bottom: 8px;"><strong>Escrow.com Integration:</strong> For high-value contracts, dedicated escrow provider offers 0.89% fees</li>
                  <li style="margin-bottom: 8px;"><strong>Automation APIs:</strong> Payoneer Withdrawal API enables fully automated fund transfers</li>
                  <li style="margin-bottom: 8px;"><strong>Global Expansion:</strong> Stripe Connect for markets beyond Philippines</li>
                  <li style="margin-bottom: 0;"><strong>Growing Remote Work:</strong> Increasing demand for Filipino talent from foreign clients</li>
                </ul>
              </div>

              <!-- Threats -->
              <div class="entity-card" style="border-width: 1px;">
                <div class="entity-title" style="color: #a16207;">Threats</div>
                <ul style="border: none; padding-left: 0; margin: 12px 0 0 0;">
                  <li style="margin-bottom: 8px;"><strong>Regulatory Changes:</strong> BSP or international payment regulations may impact operations</li>
                  <li style="margin-bottom: 8px;"><strong>FX Volatility:</strong> Currency fluctuations between USD/EUR and PHP affect contract values</li>
                  <li style="margin-bottom: 8px;"><strong>Competition:</strong> Established platforms (Upwork, Fiverr) have integrated payment systems</li>
                  <li style="margin-bottom: 8px;"><strong>Provider Dependency:</strong> Reliance on third-party APIs (Payoneer, NextPay) for core functionality</li>
                  <li style="margin-bottom: 8px;"><strong>Fraud Risk:</strong> Escrow systems are targets for payment fraud and chargebacks</li>
                  <li style="margin-bottom: 0;"><strong>API Rate Limits:</strong> High transaction volumes may hit provider rate limits</li>
                </ul>
              </div>
            </div>

            <div class="section-card" style="margin-top: 24px;">
              <div class="section-card-title">Strategic Recommendations</div>
              <table>
                <thead>
                  <tr>
                    <th>Phase</th>
                    <th>Focus</th>
                    <th>Recommendation</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td><strong>Launch</strong></td>
                    <td>Quick setup, partner integration</td>
                    <td>Payoneer + NextPay — BSP-regulated escrow, instant InstaPay/PESONet payouts, proven stack</td>
                  </tr>
                  <tr>
                    <td><strong>Growth</strong></td>
                    <td>Automation + lower fees</td>
                    <td>Add Payoneer Withdrawal API for automated transfers; negotiate NextPay volume rates</td>
                  </tr>
                  <tr>
                    <td><strong>Scale</strong></td>
                    <td>Best overall value</td>
                    <td>Evaluate Xendit as single provider — lower combined fees, faster transfers, simpler integration</td>
                  </tr>
                  <tr>
                    <td><strong>High-Value</strong></td>
                    <td>Maximum trust + low %</td>
                    <td>Escrow.com for premium contracts — 0.89% fee, dedicated escrow, 25+ year track record</td>
                  </tr>
                </tbody>
              </table>
            </div>

            <!-- Payment Provider Comparison -->
            <div class="section-card full-width-card" style="margin-top: 24px; padding: 0; overflow: hidden;">
              <div style="background: #000; color: #fff; padding: 16px 24px;">
                <div style="font-weight: 600; font-size: 1.1rem;">Payment Provider Comparison</div>
                <div style="font-size: 0.85rem; opacity: 0.8; margin-top: 4px;">For escrow flow: Foreign Client (USD/EUR) → Collection → Escrow → PHP Payout</div>
              </div>
              
              <div style="overflow-x: auto; padding: 0;">
                <table class="provider-table" style="min-width: 850px; margin: 0; border: none;">
                  <thead>
                    <tr>
                      <th style="width: 130px;">Provider</th>
                      <th style="width: 160px;">Intl Collection</th>
                      <th style="width: 160px;">PHP Payout</th>
                      <th style="width: 110px;">Escrow</th>
                      <th style="width: 90px;">API</th>
                      <th>Best For</th>
                    </tr>
                  </thead>
                  <tbody>
                    <!-- Tier Header: Recommended -->
                    <tr style="background: #dcfce7;">
                      <td colspan="6" style="padding: 8px 12px; font-weight: 600; font-size: 0.75rem; text-transform: uppercase; letter-spacing: 0.05em; color: #15803d; border-bottom: 2px solid #22c55e;">
                        ★ Recommended for Escrow Flow
                      </td>
                    </tr>
                    <tr class="row-tier1">
                      <td><strong>Xendit</strong></td>
                      <td><span class="support-full">✓</span> 130+ countries, Cards</td>
                      <td><span class="support-full">✓</span> InstaPay, 450+ banks</td>
                      <td><span class="support-full">✓</span> Built-in</td>
                      <td class="rating">★★★★★</td>
                      <td><span class="tier-badge tier-recommended">TOP PICK</span> Single API</td>
                    </tr>
                    <tr class="row-tier1">
                      <td><strong>PayMongo</strong></td>
                      <td><span class="support-full">✓</span> USD cards, Visa/MC</td>
                      <td><span class="support-full">✓</span> InstaPay, ₱10/tx</td>
                      <td><span class="support-partial">◐</span> Hold-capture</td>
                      <td class="rating">★★★★★</td>
                      <td><span class="tier-badge tier-recommended">PH BEST</span> Best docs</td>
                    </tr>
                    
                    <!-- Tier Header: Current Stack -->
                    <tr style="background: #dbeafe;">
                      <td colspan="6" style="padding: 8px 12px; font-weight: 600; font-size: 0.75rem; text-transform: uppercase; letter-spacing: 0.05em; color: #1d4ed8; border-bottom: 2px solid #3b82f6;">
                        ◆ Current Stack (Payoneer + NextPay)
                      </td>
                    </tr>
                    <tr class="row-tier1-current">
                      <td><strong>Payoneer</strong></td>
                      <td><span class="support-full">✓</span> USD/EUR/GBP trusted</td>
                      <td><span class="support-partial">◐</span> 1-5 days, 2% FX</td>
                      <td><span class="support-none">✗</span> External</td>
                      <td class="rating">★★★★☆</td>
                      <td><span class="tier-badge tier-current">IN USE</span> Brand trust</td>
                    </tr>
                    <tr class="row-tier1-current">
                      <td><strong>NextPay</strong></td>
                      <td><span class="support-none">✗</span> PHP only</td>
                      <td><span class="support-full">✓</span> InstaPay (instant)</td>
                      <td><span class="support-full">✓</span> BSP-regulated</td>
                      <td class="rating">★★★★☆</td>
                      <td><span class="tier-badge tier-current">IN USE</span> Local escrow</td>
                    </tr>
                    
                    <!-- Tier Header: Alternatives -->
                    <tr style="background: #fef3c7;">
                      <td colspan="6" style="padding: 8px 12px; font-weight: 600; font-size: 0.75rem; text-transform: uppercase; letter-spacing: 0.05em; color: #b45309; border-bottom: 2px solid #f59e0b;">
                        ○ Good Alternatives
                      </td>
                    </tr>
                    <tr class="row-tier2">
                      <td><strong>dLocal</strong></td>
                      <td><span class="support-full">✓</span> 40+ countries</td>
                      <td><span class="support-full">✓</span> GCash, Maya, banks</td>
                      <td><span class="support-partial">◐</span> Via platform</td>
                      <td class="rating">★★★★☆</td>
                      <td>Emerging markets, PH licensed</td>
                    </tr>
                    <tr class="row-tier2">
                      <td><strong>2C2P</strong></td>
                      <td><span class="support-full">✓</span> 350+ methods</td>
                      <td><span class="support-full">✓</span> PHP local rails</td>
                      <td><span class="support-partial">◐</span> Merchant held</td>
                      <td class="rating">★★★★☆</td>
                      <td>SEA coverage, next-day</td>
                    </tr>
                    <tr class="row-tier2">
                      <td><strong>Stripe Connect</strong></td>
                      <td><span class="support-full">✓</span> 135+ currencies</td>
                      <td><span class="support-partial">◐</span> Via Payoneer/Wise</td>
                      <td><span class="support-full">✓</span> 90-day delay</td>
                      <td class="rating">★★★★★</td>
                      <td>Global expansion, best DX</td>
                    </tr>
                    <tr class="row-tier2">
                      <td><strong>Wise Business</strong></td>
                      <td><span class="support-full">✓</span> 40+ currencies</td>
                      <td><span class="support-full">✓</span> InstaPay (instant)</td>
                      <td><span class="support-none">✗</span> No escrow</td>
                      <td class="rating">★★★★☆</td>
                      <td>Fast transfers, low FX</td>
                    </tr>
                    <tr class="row-tier2">
                      <td><strong>HitPay</strong></td>
                      <td><span class="support-full">✓</span> 150+ currencies</td>
                      <td><span class="support-full">✓</span> InstaPay, PESONet</td>
                      <td><span class="support-none">✗</span> No escrow</td>
                      <td class="rating">★★★☆☆</td>
                      <td>Easy setup, SME-friendly</td>
                    </tr>
                    
                    <!-- Tier Header: Specialized -->
                    <tr style="background: #f3f4f6;">
                      <td colspan="6" style="padding: 8px 12px; font-weight: 600; font-size: 0.75rem; text-transform: uppercase; letter-spacing: 0.05em; color: #6b7280; border-bottom: 2px solid #9ca3af;">
                        ◇ Specialized / Limited
                      </td>
                    </tr>
                    <tr class="row-tier3">
                      <td><strong>DragonPay</strong></td>
                      <td><span class="support-partial">◐</span> Cards + crypto</td>
                      <td><span class="support-full">✓</span> Mass payout, OTC</td>
                      <td><span class="support-none">✗</span> No escrow</td>
                      <td class="rating">★★★☆☆</td>
                      <td>Cash payouts, legacy</td>
                    </tr>
                    <tr class="row-tier3">
                      <td><strong>PesoPay</strong></td>
                      <td><span class="support-full">✓</span> USD, Visa/MC/Amex</td>
                      <td><span class="support-partial">◐</span> Settlement only</td>
                      <td><span class="support-none">✗</span> No escrow</td>
                      <td class="rating">★★★☆☆</td>
                      <td>E-commerce, 3D Secure</td>
                    </tr>
                    <tr class="row-tier3">
                      <td><strong>DSGPay</strong></td>
                      <td><span class="support-full">✓</span> 30+ currencies, VA</td>
                      <td><span class="support-partial">◐</span> Via SWIFT</td>
                      <td><span class="support-none">✗</span> No escrow</td>
                      <td class="rating">★★★☆☆</td>
                      <td>B2B cross-border</td>
                    </tr>
                    <tr class="row-tier3">
                      <td><strong>MyEG</strong></td>
                      <td><span class="support-none">✗</span> Limited intl</td>
                      <td><span class="support-full">✓</span> GCash, 100K+ OTC</td>
                      <td><span class="support-none">✗</span> No escrow</td>
                      <td class="rating">★★☆☆☆</td>
                      <td>Gov't payments only</td>
                    </tr>
                  </tbody>
                </table>
              </div>

              <div class="comparison-legend">
                <div class="legend-item"><span class="support-full">✓</span> Full support</div>
                <div class="legend-item"><span class="support-partial">◐</span> Partial/workaround</div>
                <div class="legend-item"><span class="support-none">✗</span> Not supported</div>
                <div class="legend-item"><span style="color: #666;">VA = Virtual Accounts</span></div>
                <div class="legend-item"><span style="color: #666;">OTC = Over-the-counter</span></div>
              </div>
            </div>

            <!-- Flow Recommendations by Provider -->
            <!-- Flow Recommendations by Provider -->
            <div class="section-card" style="margin-top: 24px; padding: 0; overflow: hidden;">
              <div style="background: #000; color: #fff; padding: 16px 24px;">
                <div style="font-weight: 600; font-size: 1.1rem;">Recommended Payment Flows</div>
                <div style="font-size: 0.85rem; opacity: 0.8; margin-top: 4px;">Choose based on your platform stage and priorities</div>
              </div>
              
              <div style="padding: 24px;">
                <!-- Option 1 -->
                <div style="margin-bottom: 24px;">
                  <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 12px;">
                    <span class="tier-badge tier-current">CURRENT</span>
                    <h4 style="margin: 0; font-size: 1rem;">Option 1: Payoneer + NextPay</h4>
                  </div>
                  <div class="flow-step-container">
                    <span class="flow-chip flow-chip-solid">Client (USD)</span>
                    <span class="flow-arrow">→</span>
                    <span class="flow-chip flow-chip-outline">Payoneer Checkout</span>
                    <span class="flow-arrow">→</span>
                    <span class="flow-chip flow-chip-dashed">Transfer (2-6 days)</span>
                    <span class="flow-arrow">→</span>
                    <span class="flow-chip flow-chip-solid">NextPay Escrow</span>
                    <span class="flow-arrow">→</span>
                    <span class="flow-chip flow-chip-outline">Talent (PHP)</span>
                  </div>
                  <div style="display: flex; flex-wrap: wrap; gap: 12px; font-size: 0.8rem; color: #666;">
                    <span><span class="support-full">✓</span> Brand trust</span>
                    <span><span class="support-full">✓</span> BSP escrow</span>
                    <span><span class="support-none">✗</span> 2-6 day delay</span>
                    <span><span class="support-none">✗</span> Dual integration</span>
                  </div>
                </div>

                <!-- Option 2 -->
                <div style="margin-bottom: 24px;">
                  <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 12px;">
                    <span class="tier-badge tier-recommended">RECOMMENDED</span>
                    <h4 style="margin: 0; font-size: 1rem;">Option 2: Xendit (Single Provider at Scale)</h4>
                  </div>
                  <div class="flow-step-container">
                    <span class="flow-chip flow-chip-solid">Client (USD)</span>
                    <span class="flow-arrow">→</span>
                    <span class="flow-chip flow-chip-solid">Xendit Invoice</span>
                    <span class="flow-arrow">→</span>
                    <span class="flow-chip flow-chip-solid">Xendit Hold</span>
                    <span class="flow-arrow">→</span>
                    <span class="flow-chip flow-chip-solid">Xendit Payout</span>
                    <span class="flow-arrow">→</span>
                    <span class="flow-chip flow-chip-outline">Talent (PHP)</span>
                  </div>
                  <div style="display: flex; flex-wrap: wrap; gap: 12px; font-size: 0.8rem; color: #666;">
                    <span><span class="support-full">✓</span> Single API</span>
                    <span><span class="support-full">✓</span> Instant payouts</span>
                    <span><span class="support-full">✓</span> Built-in escrow</span>
                    <span><span class="support-full">✓</span> Lower fees</span>
                  </div>
                </div>

                <!-- Option 3 -->
                <div>
                  <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 12px;">
                    <span class="tier-badge tier-alternative">ALTERNATIVE</span>
                    <h4 style="margin: 0; font-size: 1rem;">Option 3: PayMongo (PH-First)</h4>
                  </div>
                  <div class="flow-step-container">
                    <span class="flow-chip flow-chip-solid">Client (USD Card)</span>
                    <span class="flow-arrow">→</span>
                    <span class="flow-chip flow-chip-solid">PayMongo Intent</span>
                    <span class="flow-arrow">→</span>
                    <span class="flow-chip flow-chip-solid">Capture on Approval</span>
                    <span class="flow-arrow">→</span>
                    <span class="flow-chip flow-chip-solid">PayMongo Payout</span>
                    <span class="flow-arrow">→</span>
                    <span class="flow-chip flow-chip-outline">Talent (PHP)</span>
                  </div>
                  <div style="display: flex; flex-wrap: wrap; gap: 12px; font-size: 0.8rem; color: #666;">
                    <span><span class="support-full">✓</span> Best PH docs</span>
                    <span><span class="support-full">✓</span> Hold-then-capture</span>
                    <span><span class="support-full">✓</span> ₱10/payout</span>
                    <span><span class="support-partial">◐</span> Cards only for intl</span>
                  </div>
                </div>
              </div>
            </div>
          </section>

          <!-- Best Practices -->
          <section id="best-practices">
            <h2>Best Practices</h2>
            <div class="section-card">
              <ul>
                <li><strong>Idempotency:</strong> Always include <code class="code-inline">X-Idempotency-Key</code> header for POST requests to prevent duplicate transactions</li>
                <li><strong>Webhook Verification:</strong> Verify webhook signatures to ensure authenticity</li>
                <li><strong>Amount Validation:</strong> Always validate amounts match between your system and API responses</li>
                <li><strong>Status Polling:</strong> Use webhooks as primary, but implement status polling as backup</li>
                <li><strong>Error Logging:</strong> Log all API responses for debugging and audit trails</li>
                <li><strong>Balance Checks:</strong> Check account balance before initiating payouts</li>
                <li><strong>Bank Code Lookup:</strong> Use <code class="code-inline">/v1/receiving_institutions</code> to validate bank codes</li>
              </ul>
            </div>
          </section>

          <!-- Internal Notes -->
          <section id="notes" style="background: #fffbeb; border: 2px dashed #f59e0b; padding: 20px; margin-top: 40px;">
            <h2 style="color: #b45309; margin-top: 0;">Internal Notes (For Review)</h2>
            <p style="color: #92400e;"><em>This section is for internal team discussion. Remove before publishing.</em></p>
            
            <h4>Future Consideration: EOR Model</h4>
            <p>If we transition from freelance escrow to <strong>Employer of Record (EOR)</strong> model (full-time employment with Pag-IBIG, SSS, PhilHealth benefits), consider:</p>
            <ul>
              <li><strong>Single Partner:</strong> For EOR/payroll, 1 unified gateway (Xendit or Wise) is better than Payoneer + NextPay combo</li>
              <li><strong>Why:</strong> Monthly recurring payroll needs automation, 2-6 day transfer delays won't work for salary payments</li>
              <li><strong>Statutory Benefits:</strong> Need to integrate SSS, PhilHealth, Pag-IBIG contribution calculations</li>
              <li><strong>Tax Withholding:</strong> Platform becomes responsible for BIR withholding tax</li>
              <li><strong>13th Month Pay:</strong> Required by PH law for full-time employees</li>
            </ul>

            <h4>Single Partner Options</h4>
            <table>
              <thead>
                <tr>
                  <th>Provider</th>
                  <th>Collect</th>
                  <th>Payout</th>
                  <th>Best For</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td><strong>Xendit</strong></td>
                  <td>USD/EUR (130+ countries)</td>
                  <td>PHP InstaPay</td>
                  <td>SEA focus, batch payroll</td>
                </tr>
                <tr>
                  <td><strong>Wise Business</strong></td>
                  <td>80+ currencies</td>
                  <td>PHP InstaPay (instant)</td>
                  <td>Fastest transfers</td>
                </tr>
                <tr>
                  <td><strong>Rapyd</strong></td>
                  <td>100+ countries</td>
                  <td>PHP local rails</td>
                  <td>Global expansion</td>
                </tr>
              </tbody>
            </table>

            <h4>Decision Matrix</h4>
            <ul>
              <li><strong>Freelance/Contract model:</strong> Keep Payoneer + NextPay (current docs)</li>
              <li><strong>EOR with benefits:</strong> Migrate to single partner (Xendit recommended)</li>
            </ul>

            <h4 style="margin-top: 24px;">Alternative API Options (Research Dec 2024)</h4>
            <p>Based on research, here are alternative APIs worth considering for future iterations:</p>

            <!-- Escrow.com -->
            <div style="background: #f0fdf4; border: 1px solid #22c55e; padding: 12px; margin: 12px 0; border-radius: 6px;">
              <strong style="color: #15803d;">Option A: Escrow.com API</strong> — Best for dedicated escrow
              <ul style="margin: 8px 0 0 0; border: none; padding-left: 16px;">
                <li style="margin-bottom: 4px;"><strong>API:</strong> <code>api.escrow.com</code></li>
                <li style="margin-bottom: 4px;"><strong>Fees:</strong> As low as 0.89% (very competitive)</li>
                <li style="margin-bottom: 4px;"><strong>Pros:</strong> Purpose-built for escrow, no chargeback risk, 25+ year track record</li>
                <li style="margin-bottom: 4px;"><strong>Cons:</strong> Less control over UX, users may need Escrow.com accounts</li>
                <li style="margin-bottom: 0;"><strong>Flow:</strong> <code>POST /transaction</code> → <code>/agree</code> → <code>/fund</code> → <code>/disburse</code></li>
              </ul>
            </div>

            <!-- Xendit -->
            <div style="background: #dbeafe; border: 1px solid #3b82f6; padding: 12px; margin: 12px 0; border-radius: 6px;">
              <strong style="color: #1d4ed8;">Option B: Xendit</strong> — Best single-provider solution for SEA
              <ul style="margin: 8px 0 0 0; border: none; padding-left: 16px;">
                <li style="margin-bottom: 4px;"><strong>Coverage:</strong> 130+ countries, PHP InstaPay built-in</li>
                <li style="margin-bottom: 4px;"><strong>API:</strong> Single API for collect + hold + disburse</li>
                <li style="margin-bottom: 4px;"><strong>Pros:</strong> Eliminates Payoneer→NextPay bridge, faster transfers, escrow support</li>
                <li style="margin-bottom: 4px;"><strong>Cons:</strong> Lower brand recognition than Payoneer for international clients</li>
                <li style="margin-bottom: 0;"><strong>Best For:</strong> Scaling marketplaces (500+ tx/mo)</li>
              </ul>
            </div>

            <!-- Stripe Connect -->
            <div style="background: #fef3c7; border: 1px solid #f59e0b; padding: 12px; margin: 12px 0; border-radius: 6px;">
              <strong style="color: #b45309;">Option C: Stripe Connect</strong> — Global standard for marketplaces
              <ul style="margin: 8px 0 0 0; border: none; padding-left: 16px;">
                <li style="margin-bottom: 4px;"><strong>Coverage:</strong> 45+ countries, premium DX</li>
                <li style="margin-bottom: 4px;"><strong>Pros:</strong> Industry-standard API, best documentation, trusted brand</li>
                <li style="margin-bottom: 4px;"><strong>Cons:</strong> Higher fees, limited PHP payout options (may need local partner)</li>
                <li style="margin-bottom: 0;"><strong>Best For:</strong> Premium marketplace UX, global expansion beyond PH</li>
              </ul>
            </div>

            <h4 style="margin-top: 20px;">Recommendation Summary</h4>
            <table>
              <thead>
                <tr>
                  <th>Scenario</th>
                  <th>Recommended</th>
                  <th>Why</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>Starting out (&lt;50 tx/mo)</td>
                  <td><strong>Payoneer + NextPay</strong></td>
                  <td>Current stack, Payoneer brand trust</td>
                </tr>
                <tr>
                  <td>Growing (50-500 tx/mo)</td>
                  <td><strong>Xendit</strong></td>
                  <td>Single API, faster PH transfers</td>
                </tr>
                <tr>
                  <td>High-value contracts</td>
                  <td><strong>Escrow.com</strong></td>
                  <td>Maximum trust, dedicated escrow</td>
                </tr>
                <tr>
                  <td>Global expansion</td>
                  <td><strong>Stripe Connect + local</strong></td>
                  <td>Best global coverage</td>
                </tr>
              </tbody>
            </table>

            <div style="background: #f4f4f4; border-left: 3px solid #000; padding: 12px; margin-top: 16px;">
              <strong>Current Assessment:</strong> Payoneer + NextPay approach is ✅ <strong>DOABLE</strong>. Main challenge is 2-6 day transfer delay which is addressed by automation options in docs.
            </div>
          </section>

          <!-- Footer -->
          <footer style="margin-top: 60px; padding-top: 30px; border-top: 1px solid var(--border-color);">
            <p style="color: var(--text-muted); font-size: 0.9rem;">
              For complete API reference, visit <a href="https://api.partners.nextpay.world/docs" style="color: #000;" rel="noopener noreferrer" target="_blank">api.partners.nextpay.world/docs</a><br>
              Last updated: December 19, 2024 | NextPay Partners API v1 | Payment Provider Research Updated
            </p>
          </footer>
        </div>
      </main>

      <!-- Mobile Sidebar Toggle -->
      <button class="sidebar-toggle" id="sidebarToggle" aria-label="Toggle navigation">
        ☰
      </button>
    </div>

    <script>
      // Search functionality
      const searchInput = document.getElementById('searchInput');
      const searchResults = document.getElementById('searchResults');

      // Searchable content
      const searchableItems = [
        { title: 'Platform Overview', section: 'Getting Started', id: 'overview' },
        { title: 'Core Entities', section: 'Getting Started', id: 'entities' },
        { title: 'Authentication', section: 'Getting Started', id: 'authentication' },
        { title: 'Partner', section: 'Core Entities', id: 'entities' },
        { title: 'Merchant', section: 'Core Entities', id: 'entities' },
        { title: 'Account', section: 'Core Entities', id: 'entities' },
        { title: 'Payment Intent', section: 'Core Entities', id: 'entities' },
        { title: 'Payout Request', section: 'Core Entities', id: 'entities' },
        { title: 'Initial Setup', section: 'Setup', id: 'setup' },
        { title: 'Create Merchant', section: 'Setup', id: 'create-merchant' },
        { title: 'Create Account', section: 'Setup', id: 'create-account' },
        { title: 'Complete Escrow Flow', section: 'Escrow Flow', id: 'flow' },
        { title: 'International Payment (Payoneer)', section: 'Escrow Flow', id: 'payoneer-flow' },
        { title: 'Confirm Funds', section: 'Escrow Flow', id: 'payment-success' },
        { title: 'Release Funds', section: 'Escrow Flow', id: 'release-funds' },
        { title: 'Payout Webhook', section: 'Escrow Flow', id: 'payout-webhook' },
        { title: 'Refund Flow', section: 'Reference', id: 'refund' },
        { title: 'Webhooks', section: 'Reference', id: 'webhooks' },
        { title: 'payment_intent.succeeded', section: 'Webhooks', id: 'webhooks' },
        { title: 'payment_intent.failed', section: 'Webhooks', id: 'webhooks' },
        { title: 'payout.succeeded', section: 'Webhooks', id: 'webhooks' },
        { title: 'payout.failed', section: 'Webhooks', id: 'webhooks' },
        { title: 'Error Handling', section: 'Reference', id: 'errors' },
        { title: 'API Endpoints', section: 'Reference', id: 'endpoints' },
        { title: 'Best Practices', section: 'Reference', id: 'best-practices' },
        { title: 'Idempotency', section: 'Best Practices', id: 'best-practices' },
        { title: 'QR Code', section: 'Payment Intent', id: 'payment-intent' },
        { title: 'Platform Fee', section: 'Release Funds', id: 'release-funds' },
        { title: 'Bank Code', section: 'Reference', id: 'endpoints' },
        { title: 'InstaPay', section: 'Settlement Rails', id: 'release-funds' },
        { title: 'PESONet', section: 'Settlement Rails', id: 'release-funds' },
      ];

      searchInput.addEventListener('input', function(e) {
        const query = e.target.value.toLowerCase().trim();
        
        if (query.length < 2) {
          searchResults.classList.remove('active');
          return;
        }

        const results = searchableItems.filter(item => 
          item.title.toLowerCase().includes(query) ||
          item.section.toLowerCase().includes(query)
        );

        if (results.length === 0) {
          searchResults.innerHTML = '<div class="search-no-results">No results found</div>';
        } else {
          searchResults.innerHTML = results.slice(0, 8).map(item => `
            <div class="search-result-item" data-id="${item.id}">
              <div class="search-result-title">${item.title}</div>
              <div class="search-result-section">${item.section}</div>
            </div>
          `).join('');
        }

        searchResults.classList.add('active');
      });

      searchResults.addEventListener('click', function(e) {
        const item = e.target.closest('.search-result-item');
        if (item) {
          const id = item.dataset.id;
          const element = document.getElementById(id);
          if (element) {
            element.scrollIntoView({ behavior: 'smooth' });
            searchResults.classList.remove('active');
            searchInput.value = '';
            
            // Update active nav link
            document.querySelectorAll('.nav-link').forEach(link => link.classList.remove('active'));
            document.querySelector(`a[href="#${id}"]`)?.classList.add('active');
          }
        }
      });

      // Close search results when clicking outside
      document.addEventListener('click', function(e) {
        if (!e.target.closest('.search-container')) {
          searchResults.classList.remove('active');
        }
      });

      // Active navigation link on scroll
      const sections = document.querySelectorAll('section[id]');
      const navLinks = document.querySelectorAll('.nav-link');

      window.addEventListener('scroll', () => {
        let current = '';
        
        sections.forEach(section => {
          const sectionTop = section.offsetTop;
          const sectionHeight = section.clientHeight;
          
          if (window.scrollY >= sectionTop - 100) {
            current = section.getAttribute('id');
          }
        });

        navLinks.forEach(link => {
          link.classList.remove('active');
          if (link.getAttribute('href') === `#${current}`) {
            link.classList.add('active');
          }
        });
      });

      // Mobile sidebar toggle
      const sidebarToggle = document.getElementById('sidebarToggle');
      const sidebar = document.getElementById('sidebar');

      sidebarToggle.addEventListener('click', () => {
        sidebar.classList.toggle('open');
      });

      // Close sidebar when clicking a link on mobile
      navLinks.forEach(link => {
        link.addEventListener('click', () => {
          if (window.innerWidth <= 900) {
            sidebar.classList.remove('open');
          }
        });
      });

      // Keyboard shortcut for search (Ctrl/Cmd + K)
      document.addEventListener('keydown', function(e) {
        if ((e.ctrlKey || e.metaKey) && e.key === 'k') {
          e.preventDefault();
          searchInput.focus();
        }
        
        // Escape to close search
        if (e.key === 'Escape') {
          searchResults.classList.remove('active');
          searchInput.blur();
        }
      });
    </script>
  </body>
</html>
